<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Apply for a Position — Careers</title>

  <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-7F1WP8JXBL"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-7F1WP8JXBL', {
        page_location: 'https://velvelt.onrender.com/',
        page_title: 'Jobs Next Door - Career Partner in Recruitment'
    });
  </script>

  <!-- Modern, professional color variables -->
  <style>
    :root {
      --bg: #f6f8fb;
      --card: #ffffff;
      --muted: #6b7280;
      --accent: #0f5bff;
      --accent-600: #0a47d1;
      --success: #06b6a4;
      --danger: #ef4444;
      --glass: rgba(15,91,255,0.06);
      --shadow: 0 6px 18px rgba(19, 24, 44, 0.08);
      --radius: 12px;
      --max-width: 1100px;
      --transition: 200ms ease;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    /* Page layout */
    body {
      margin: 0;
      background: linear-gradient(180deg, var(--bg), #ffffff 60%);
      color: #111827;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      padding: 40px 20px;
      display: flex;
      justify-content: center;
      font-size: 15px;
      line-height: 1.4;
    }

    .page {
      width: 100%;
      max-width: var(--max-width);
    }

    header.hero {
      display: flex;
      justify-content: space-between;
      gap: 24px;
      align-items: flex-start;
      margin-bottom: 28px;
    }

    .hero-left {
      flex: 1 1 480px;
      min-width: 220px;
    }

    .hero-right {
      width: 420px;
      display: flex;
      justify-content: flex-end;
      align-items: center;
    }

    h1 {
      margin: 0 0 8px 0;
      font-size: 28px;
      letter-spacing: -0.2px;
    }

    p.lead {
      margin: 0;
      color: var(--muted);
    }

    /* Partner logos & stats */
    .partners {
      margin-top: 18px;
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    .partner {
      background: var(--card);
      padding: 8px 12px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: var(--shadow);
    }

    .partner img {
      height: 28px;
      opacity: .92;
    }

    .stats {
      display: flex;
      gap: 16px;
      margin-top: 18px;
      align-items: center;
      flex-wrap: wrap;
    }

    .stat {
      background: linear-gradient(180deg, #fff, #fbfdff);
      border-radius: 10px;
      padding: 12px 14px;
      box-shadow: var(--shadow);
      min-width: 110px;
      text-align: center;
    }

    .stat b {
      display: block;
      font-size: 18px;
      color: var(--accent);
    }

    .stat small {
      color: var(--muted);
      font-size: 12px;
    }

    /* Main form + card */
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 420px;
      gap: 24px;
      align-items: start;
    }

    .form-card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 22px;
      box-shadow: var(--shadow);
    }

    .side-card {
      background: linear-gradient(180deg, #ffffff, #fbfdff);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      position: sticky;
      top: 24px;
      height: max-content;
    }

    /* Form inner layout */
    .application-form .form-section-group {
      margin-bottom: 18px;
    }

    .form-section-title {
      margin: 0 0 8px;
      font-size: 16px;
      color: #111827;
    }

    .form-row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .form-group {
      flex: 1 1 180px;
      display: flex;
      flex-direction: column;
      margin-bottom: 10px;
    }

    label.form-label {
      font-weight: 600;
      margin-bottom: 6px;
      font-size: 13px;
      color: #111827;
    }

    .form-input, .form-select, .form-textarea {
      background: #fbfdff;
      border: 1px solid #e6eef9;
      padding: 10px 12px;
      border-radius: 10px;
      outline: none;
      transition: box-shadow var(--transition), border-color var(--transition);
      font-size: 14px;
      color: #0f1724;
    }

    .form-input:focus, .form-select:focus, .form-textarea:focus {
      border-color: var(--accent-600);
      box-shadow: 0 4px 18px rgba(15,91,255,0.08);
    }

    .form-textarea {
      resize: vertical;
      min-height: 84px;
    }

    /* file input: visually hidden base + custom label */
    .file-input {
      position: absolute;
      opacity: 0;
      pointer-events: none;
      height: 0;
      width: 0;
    }

    .file-label {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      border: 1px dashed #e6eef9;
      padding: 10px;
      border-radius: 10px;
      background: var(--glass);
      color: var(--muted);
      font-size: 13px;
      transition: background var(--transition), border-color var(--transition);
    }

    .file-label:hover {
      background: rgba(15,91,255,0.08);
      border-color: var(--accent-600);
    }

    .file-icon {
      display: inline-block;
      width: 20px;
      height: 20px;
      background: linear-gradient(90deg, var(--accent), var(--accent-600));
      border-radius: 5px;
    }

    /* terms group */
    .terms-checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin: 12px 0;
    }

    .terms-checkbox {
      margin-right: 10px;
      transform: translateY(1px);
    }

    .terms-label {
      font-size: 13px;
      color: var(--muted);
    }

    .terms-link {
      color: var(--accent);
      text-decoration: none;
    }

    .terms-link:hover {
      text-decoration: underline;
    }

    /* actions */
    .form-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 12px;
    }

    .btn {
      border: 0;
      padding: 10px 14px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: transform var(--transition), box-shadow var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn.send {
      background: linear-gradient(90deg, var(--accent), var(--accent-600));
      color: #fff;
      box-shadow: 0 8px 24px rgba(15,91,255,0.18);
    }

    .btn.reset {
      background: #fff;
      color: var(--muted);
      border: 1px solid #e6eef9;
    }

    .btn:active {
      transform: translateY(1px);
    }

    /* disabled states */
    .btn[disabled] {
      opacity: .6;
      cursor: not-allowed;
      transform: none;
    }

    /* side content: testimonials & badges */
    .testimonial {
      display: flex;
      gap: 12px;
      align-items: flex-start;
      margin-bottom: 14px;
    }

    .testimonial .avatar {
      width: 56px;
      height: 56px;
      border-radius: 12px;
      background: #eef6ff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: var(--accent);
    }

    .testimonial p {
      margin: 0;
      color: var(--muted);
      font-size: 14px;
    }

    .badge-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .badge {
      background: #fff;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #eef3ff;
      font-size: 13px;
      color: var(--muted);
      display: flex;
      gap: 8px;
      align-items: center;
    }

    /* small utilities */
    .muted {
      color: var(--muted);
      font-size: 13px;
    }

    .center {
      text-align: center;
    }

    /* responsive */
    @media (max-width: 980px) {
      .form-grid {
        grid-template-columns: 1fr;
        align-items: stretch;
      }

      .hero-right {
        display: none;
      }
    }

    @media (max-width: 420px) {
      h1 {
        font-size: 22px;
      }

      .partner img {
        height: 20px;
      }
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
  </style>
</head>

<body>
  <div class="page">
    <!-- HERO with partner logos and success stats -->
    <header class="hero">
      <div class="hero-left">
        <h1>Apply for a Position — Join top companies</h1>
        <p class="lead">We connect talented professionals with leading companies across all industries. Submit your application quickly and securely.</p>

        <div class="partners" aria-hidden="false" title="Trusted partners">
          <!-- Replace src with real partner logo paths -->
          <div class="partner"><img src="https://via.placeholder.com/88x28?text=Acme" alt="Acme logo"></div>
          <div class="partner"><img src="https://via.placeholder.com/88x28?text=Globex" alt="Globex logo"></div>
          <div class="partner"><img src="https://via.placeholder.com/88x28?text=Innotech" alt="Innotech logo"></div>
          <div class="partner"><img src="https://via.placeholder.com/88x28?text=Orbit" alt="Orbit logo"></div>
        </div>

        <div class="stats" role="list" aria-label="Success statistics">
          <div class="stat" role="listitem"><b data-target="2500">2500+</b><small>Placements</small></div>
          <div class="stat" role="listitem"><b data-target="98">98%</b><small>Client Satisfaction</small></div>
          <div class="stat" role="listitem"><b data-target="120">120</b><small>Hiring Partners</small></div>
        </div>
      </div>

      <!-- Right side quick pitch / security badges -->
      <div class="hero-right">
        <div class="side-card">
          <div class="center" style="margin-bottom:10px;">
            <strong>Secure & Compliant</strong>
            <p class="muted" style="margin:6px 0 0;">Your data is protected and processed under strict security standards.</p>
          </div>

          <div class="badge-row" aria-hidden="false">
            <div class="badge"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 12l3 7h12l3-7-3-7H6L3 12z" fill="#eef6ff"/></svg> SOC 2</div>
            <div class="badge"><svg width="18" height="18" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="#eef6ff"/></svg> GDPR</div>
            <div class="badge"><svg width="18" height="18" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="3" fill="#eef6ff"/></svg> ISO/IEC 27001</div>
          </div>

          <hr style="margin:12px 0;border:none;border-top:1px solid #eef3ff">

          <div class="center">
            <small class="muted">Average time to placement</small>
            <div style="font-size:20px;font-weight:700;color:var(--accent);margin-top:6px;">4–8 weeks</div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main grid: form + sidebar testimonials -->
    <main class="form-grid" aria-labelledby="formHeading">
      <section class="form-card" aria-labelledby="formHeading">
        <div class="form-header" style="margin-bottom:12px">
          <h2 id="formHeading" class="form-title" style="margin:0 0 8px;font-size:20px">Apply for a Position</h2>
          <p class="form-description muted">Fill out the form below to submit your application. We keep your resume secure and confidential.</p>
        </div>

        <!-- FORM: kept original Flask action and input names -->
        <form
          id="jobForm"
          class="application-form"
          action="{{ url_for('index') }}"
          method="POST"
          enctype="multipart/form-data"
          novalidate
        >
          <!-- Personal -->
          <div class="form-section-group">
            <h3 class="form-section-title">Personal Information</h3>

            <div class="form-row">
              <div class="form-group">
                <label for="first" class="form-label">First name *</label>
                <input type="text" id="first" name="first_name" class="form-input" placeholder="First name" required aria-required="true">
              </div>

              <div class="form-group">
                <label for="last" class="form-label">Last name *</label>
                <input type="text" id="last" name="last_name" class="form-input" placeholder="Last name" required aria-required="true">
              </div>
            </div>

            <div class="form-group">
              <label for="email" class="form-label">Email *</label>
              <input type="email" id="email" name="email" class="form-input" placeholder="Email" required aria-required="true">
            </div>

            <div class="form-group">
              <label for="phone" class="form-label">Phone *</label>
              <input type="tel" id="phone" name="phone" class="form-input" placeholder="Phone" required aria-required="true">
            </div>
          </div>

          <!-- Location -->
          <div class="form-section-group">
            <h3 class="form-section-title">Location</h3>

            <div class="form-row">
              <div class="form-group">
                <label for="country" class="form-label">Country *</label>
                <select id="country" name="country" class="form-select" required aria-required="true">
                  <option value="">Choose country</option>
                  <option>United States</option>
                  <option>India</option>
                  <option>United Kingdom</option>
                  <option>Australia</option>
                </select>
              </div>

              <div class="form-group">
                <label for="city" class="form-label">City *</label>
                <input type="text" id="city" name="city" class="form-input" placeholder="City" required aria-required="true">
              </div>
            </div>

            <div class="form-group">
              <label for="address" class="form-label">Address *</label>
              <input type="text" id="address" name="address" class="form-input" placeholder="Address" required aria-required="true">
            </div>
          </div>

          <!-- Position -->
          <div class="form-section-group">
            <h3 class="form-section-title">Position Details</h3>

            <div class="form-group">
              <label for="position" class="form-label">Position applying for *</label>
              <select id="position" name="position" class="form-select" required aria-required="true">
                <option value="">Choose position</option>
                <option>Full Stack Engineer</option>
                <option>Product Manager</option>
                <option>UI/UX Designer</option>
              </select>
            </div>

            <div class="form-group">
              <label for="info" class="form-label">Additional information</label>
              <textarea id="info" name="additional_info" class="form-textarea" placeholder="Anything else you'd like us to know" rows="4"></textarea>
            </div>

            <div class="form-group" style="position:relative;">
              <label for="cv" class="form-label">Resume / CV *</label>

              <!-- original file input retained but visually hidden -->
              <input type="file" id="cv" name="resume" accept=".pdf,.doc,.docx" class="file-input" required aria-required="true">

              <!-- custom label that shows file name -->
              <label for="cv" class="file-label" id="fileLabel" aria-live="polite">
                <span class="file-icon" aria-hidden="true"></span>
                <span id="fileName">Click to upload your resume (PDF, DOC, DOCX)</span>
              </label>

              <!-- small hint -->
              <div class="muted" style="margin-top:8px;font-size:13px">Max file size 5 MB. We only accept PDF or Word docs.</div>
            </div>
          </div>

          <!-- Terms -->
          <div class="terms-checkbox-group" aria-label="Terms and conditions">
            <div class="terms-checkbox-item">
              <input type="checkbox" id="terms1" name="terms1" class="terms-checkbox" required>
              <label for="terms1" class="terms-label">
                I agree to the
                <a href="{{ url_for('terms_data_collection', **query_params) }}" class="terms-link" target="_blank" id="termsLink1">Data Collection and Privacy Policy</a>
              </label>
            </div>

            <div class="terms-checkbox-item">
              <input type="checkbox" id="terms2" name="terms2" class="terms-checkbox" required>
              <label for="terms2" class="terms-label">
                I consent to the
                <a href="{{ url_for('terms_communication', **query_params) }}" class="terms-link" target="_blank" id="termsLink2">Communication and Contact Terms</a>
              </label>
            </div>

            <div class="terms-checkbox-item">
              <input type="checkbox" id="terms3" name="terms3" class="terms-checkbox" required>
              <label for="terms3" class="terms-label">
                I accept the
                <a href="{{ url_for('terms_recruitment', **query_params) }}" class="terms-link" target="_blank" id="termsLink3">Recruitment Process and Job Matching Terms</a>
              </label>
            </div>
          </div>

          <!-- Actions -->
          <div class="form-actions">
            <button type="button" class="btn reset" id="resetBtn">Reset</button>
            <button type="submit" class="btn send" id="submitBtn" aria-live="polite">
              <svg id="submitSpinner" width="16" height="16" viewBox="0 0 24 24" fill="none" style="display:none;animation:spin 1s linear infinite;">
                <path d="M12 2a10 10 0 1 0 10 10" stroke="#fff" stroke-width="2" stroke-linecap="round"></path>
              </svg>
              <span id="submitText">Send</span>
            </button>
          </div>
        </form>
      </section>

      <!-- Sidebar: testimonials and security badges -->
      <aside class="side-card" aria-label="Testimonials and trust">
        <strong style="display:block;margin-bottom:12px">What candidates say</strong>

        <article class="testimonial" aria-label="Candidate testimonial">
          <div class="avatar" aria-hidden="true" style="background:#eef6ff;color:var(--accent)">AM</div>
          <div>
            <p style="margin-bottom:6px;">"I was placed within 3 weeks. Communication was fast and respectful — highly recommended."</p>
            <small class="muted">— Amanda M., Product Manager</small>
          </div>
        </article>

        <article class="testimonial" aria-label="Candidate testimonial">
          <div class="avatar" aria-hidden="true" style="background:#fff7ed;color:#fb923c">JT</div>
          <div>
            <p style="margin-bottom:6px;">"Great support during interviews and excellent match quality."</p>
            <small class="muted">— James T., Full Stack</small>
          </div>
        </article>

        <hr style="border:none;border-top:1px solid #eef3ff;margin:12px 0;">

        <div>
          <small class="muted">Security & compliance</small>
          <div class="badge-row" style="margin-top:8px">
            <div class="badge">Encrypted upload</div>
            <div class="badge">Data minimization</div>
            <div class="badge">Verified partners</div>
          </div>
        </div>
      </aside>
    </main>
  </div>

  <!-- JavaScript: file name display, form validation, loading states, basic counters -->
  <script>
    // Enhanced GA4 Tracking Functions with Parameter Preservation
    function getCampaignParams() {
        const urlParams = new URLSearchParams(window.location.search);
        const campaignParams = {};

        for (const [key, value] of urlParams) {
            if (key.includes('utm_') || key === 'gclid' || key === 'fbclid' || key.includes('utm_id')) {
                campaignParams[key] = value;
            }
        }

        return campaignParams;
    }

    function getL1UrlWithParams(path = '') {
        const baseUrl = 'https://velvelt.onrender.com';
        const fullPath = path ? `${baseUrl}/${path}` : baseUrl;
        const urlObj = new URL(fullPath);

        // Add all campaign parameters
        const campaignParams = getCampaignParams();
        Object.entries(campaignParams).forEach(([key, value]) => {
            urlObj.searchParams.set(key, value);
        });

        return urlObj.toString();
    }

    function trackFormInteraction(action, element, value = null) {
      gtag('event', 'form_interaction', {
        event_category: 'form',
        event_label: action,
        element_type: element.type || 'button',
        element_name: element.name || element.id || 'unknown',
        value: value,
        page_location: getL1UrlWithParams(),
        ...getCampaignParams() // Include parameters as event parameters
      });
    }

    function trackFormSubmission(formData) {
      gtag('event', 'form_submission', {
        event_category: 'conversion',
        event_label: 'job_application',
        form_id: 'careers_form',
        form_type: 'job_application',
        user_type: 'candidate',
        page_location: getL1UrlWithParams(),
        ...getCampaignParams()
      });

      // Enhanced conversion tracking
      gtag('event', 'generate_lead', {
        currency: 'USD',
        value: 0,
        page_location: getL1UrlWithParams(),
        ...getCampaignParams()
      });
    }

    function trackButtonClick(button, action) {
      gtag('event', 'button_click', {
        event_category: 'engagement',
        event_label: action,
        button_text: button.textContent.trim(),
        button_id: button.id,
        page_location: getL1UrlWithParams(),
        ...getCampaignParams()
      });
    }

    function trackFileUpload(file) {
      gtag('event', 'file_upload', {
        event_category: 'form',
        event_label: 'resume_upload',
        file_name: file.name,
        file_size: file.size,
        file_type: file.type,
        page_location: getL1UrlWithParams(),
        ...getCampaignParams()
      });
    }

    // Enhanced event listeners with GA4 tracking
    document.addEventListener('DOMContentLoaded', function() {
        // Log parameters for debugging
        const params = getCampaignParams();
        if (Object.keys(params).length > 0) {
            console.log('📋 Detected campaign parameters:', params);
        }

        // Update GA4 configuration with parameters
        gtag('config', 'G-7F1WP8JXBL', {
            page_location: getL1UrlWithParams(),
            page_title: 'Apply for a Position — Careers',
            ...params
        });

        // Track form field interactions
        const formFields = document.querySelectorAll('input, select, textarea');
        formFields.forEach(field => {
            field.addEventListener('focus', () => {
                trackFormInteraction('field_focus', field);
            });

            field.addEventListener('change', () => {
                trackFormInteraction('field_change', field, field.value);
            });
        });

        // Track all button clicks
        document.querySelectorAll('button').forEach(button => {
            button.addEventListener('click', () => {
                trackButtonClick(button, button.textContent.trim());
            });
        });

        // Track link clicks with parameter preservation
        document.querySelectorAll('a').forEach(link => {
            // Skip if it's already a full L1 URL
            if (!link.href.includes('velvelt.onrender.com')) {
                link.addEventListener('click', (e) => {
                    gtag('event', 'link_click', {
                        event_category: 'navigation',
                        event_label: link.textContent.trim(),
                        link_url: link.href,
                        page_location: getL1UrlWithParams(),
                        ...getCampaignParams()
                    });
                });
            }
        });

        // Update terms links to include parameters
        document.querySelectorAll('.terms-link').forEach(link => {
            const originalHref = link.getAttribute('href');
            if (originalHref && originalHref.includes('velvelt.onrender.com')) {
                const urlObj = new URL(originalHref);
                Object.entries(getCampaignParams()).forEach(([key, value]) => {
                    urlObj.searchParams.set(key, value);
                });
                link.href = urlObj.toString();
            }
        });

        // Track page view with parameters
        gtag('event', 'page_view', {
            page_title: 'Apply for a Position — Careers',
            page_location: getL1UrlWithParams(),
            user_type: 'candidate',
            ...getCampaignParams()
        });

        console.log('✅ GA4 tracking initialized with parameter preservation');
    });

    // Elements
    const jobForm = document.getElementById('jobForm');
    const cvInput = document.getElementById('cv');
    const fileNameEl = document.getElementById('fileName');
    const submitBtn = document.getElementById('submitBtn');
    const submitText = document.getElementById('submitText');
    const submitSpinner = document.getElementById('submitSpinner');
    const resetBtn = document.getElementById('resetBtn');

    // Show filename when user selects file
    cvInput.addEventListener('change', () => {
        const file = cvInput.files[0];
        if (!file) {
            fileNameEl.textContent = 'Click to upload your resume (PDF, DOC, DOCX)';
            return;
        }

        // Simple size check (5MB)
        const maxBytes = 5 * 1024 * 1024;
        if (file.size > maxBytes) {
            fileNameEl.textContent = 'File too large. Max 5MB.';
            fileNameEl.style.color = 'var(--danger)';
            // Clear file input for user to reselect
            cvInput.value = '';
            return;
        }

        fileNameEl.style.color = '';
        fileNameEl.textContent = file.name;

        // Track file upload
        trackFileUpload(file);
    });

    // Form client-side validation + loading state
    jobForm.addEventListener('submit', (e) => {
        // Prevent default submission to demonstrate loading state. Remove if server submission is desired.
        e.preventDefault();

        // Native constraint validation
        if (!jobForm.checkValidity()) {
            // Show browser validation UI
            jobForm.reportValidity();
            return;
        }

        // Extra check: ensure resume chosen
        if (!cvInput.files || cvInput.files.length === 0) {
            cvInput.focus();
            fileNameEl.textContent = 'Please upload your resume.';
            fileNameEl.style.color = 'var(--danger)';
            return;
        }

        // Check terms acceptance
        const termsCheckboxes = document.querySelectorAll('.terms-checkbox');
        const allTermsChecked = Array.from(termsCheckboxes).every(cb => cb.checked);

        if (!allTermsChecked) {
            alert('Please accept all terms and conditions');
            gtag('event', 'form_validation_failed', {
                event_category: 'Form',
                event_label: 'Terms not accepted',
                page_location: getL1UrlWithParams(),
                ...getCampaignParams()
            });
            return;
        }

        // Start loading state
        submitBtn.disabled = true;
        submitSpinner.style.display = 'inline-block';
        submitText.textContent = 'Sending...';

        // Track form submission
        const formData = new FormData(jobForm);
        trackFormSubmission(formData);

        // Simulate upload and submission (replace with actual submit)
        setTimeout(() => {
            // End loading state
            submitSpinner.style.display = 'none';
            submitText.textContent = 'Sent ✓';
            submitBtn.style.boxShadow = '0 8px 24px rgba(6,182,164,0.12)';
            submitBtn.disabled = false;

            // Track successful submission
            gtag('event', 'form_submission_success', {
                event_category: 'conversion',
                event_label: 'job_application_success',
                page_location: getL1UrlWithParams(),
                ...getCampaignParams()
            });

            // Optional: actually post the form (uncomment if desired)
            // jobForm.submit();

            // Provide a brief success message
            alert('Application submitted (demo).');
        }, 1500);
    });

    // Reset button resets form and file label
    resetBtn.addEventListener('click', () => {
        jobForm.reset();
        fileNameEl.textContent = 'Click to upload your resume (PDF, DOC, DOCX)';
        fileNameEl.style.color = '';

        // Track form reset
        gtag('event', 'form_reset', {
            event_category: 'form',
            event_label: 'form_reset',
            page_location: getL1UrlWithParams(),
            ...getCampaignParams()
        });
    });

    // Simple animated counters for stats
    document.querySelectorAll('[data-target]').forEach(el => {
        const target = +el.getAttribute('data-target');
        let current = 0;
        const step = Math.max(1, Math.floor(target / 60));

        const timer = setInterval(() => {
            current += step;
            if (current >= target) {
                el.textContent = target + (el.textContent.includes('%') ? '%' : '');
                clearInterval(timer);
            } else {
                el.textContent = current + (el.textContent.includes('%') ? '%' : '');
            }
        }, 16);
    });

    // keyboard accessibility: allow "Space"/"Enter" on file label (optional)
    const fileLabel = document.getElementById('fileLabel');
    fileLabel.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            cvInput.click();
        }
    });

    // Track scroll depth
    let scrollTracked = false;
    window.addEventListener('scroll', () => {
        if (!scrollTracked && window.scrollY > 500) {
            gtag('event', 'scroll_depth', {
                event_category: 'engagement',
                event_label: '50_percent_scroll',
                page_location: getL1UrlWithParams(),
                ...getCampaignParams()
            });
            scrollTracked = true;
        }
    });

    // Track time on page with parameters
    const pageStartTime = Date.now();
    window.addEventListener('beforeunload', () => {
        const timeSpent = Math.round((Date.now() - pageStartTime) / 1000);
        gtag('event', 'page_time_spent', {
            event_category: 'Engagement',
            event_label: 'Time spent on page',
            time_seconds: timeSpent,
            page_location: getL1UrlWithParams(),
            ...getCampaignParams()
        });
    });

    // Debug function to check current parameters
    window.debugGA4Params = function() {
        console.log('🔍 Current Campaign Parameters:', getCampaignParams());
        console.log('🌐 Current L1 URL:', getL1UrlWithParams());
        console.log('📊 DataLayer events:', window.dataLayer || []);
    };

    // Uncomment the line below to enable debug mode
    // window.debugGA4Params();
</script>
</body>
</html>